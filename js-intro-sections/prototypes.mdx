import { SlideLayout, Image, FlexBox, UnorderedList, ListItem, Box} from 'spectacle'

<SlideLayout.Center>
## Understanding Prototypes

```javascript
// Every object has a prototype
const person = {
  name: 'Alice',
  greet() {
    return `Hello, I'm ${this.name}`;
  }
};

// Create new object with person as prototype
const student = Object.create(person);
student.grade = 'A';

console.log(student.name);    // 'Alice' (inherited)
console.log(student.greet()); // 'Hello, I'm Alice'
console.log(student.grade);   // 'A' (own property)
```
</SlideLayout.Center>

<SlideLayout.Center>
## Exercise: Build a Prototype Chain

```javascript
// Create a vehicle prototype system
const vehicle = {
  start() {
    return `${this.type || 'Vehicle'} starting...`;
  },
  stop() {
    return `${this.type || 'Vehicle'} stopped.`;
  }
};

// TODO: Create car prototype that inherits from vehicle
// Should have type 'Car' and a drive() method
const car = {}; // Your code here

// TODO: Create specific car instance
const myCar = {}; // Your code here
// Should have make: 'Toyota', model: 'Camry'

console.log(myCar.start());  // 'Car starting...'
console.log(myCar.drive());  // 'Toyota Camry is driving'

// ***
describe('Prototype Chain - Initial Implementation', () => {
  it('should inherit start method', () => {
    expect(myCar.start).to.exist;
    expect(myCar.start).to.be.a('function');
  });
  
  it('should use car type in start message', () => {
    expect(myCar.start()).to.equal('Car starting...');
  });
  
  it('should have drive method', () => {
    expect(myCar.drive).to.exist;
    expect(myCar.drive).to.be.a('function');
  });
  
  it('should use make and model in drive message', () => {
    expect(myCar.drive()).to.equal('Toyota Camry is driving');
  });
});
// ---
// Step 1: Create car prototype
const vehicle = {
  start() {
    return `${this.type || 'Vehicle'} starting...`;
  },
  stop() {
    return `${this.type || 'Vehicle'} stopped.`;
  }
};

const car = Object.create(vehicle);
car.type = 'Car';
car.drive = function() {
  return `${this.make} ${this.model} is driving`;
};

const myCar = Object.create(car);
myCar.make = 'Toyota';
myCar.model = 'Camry';

console.log(myCar.start());  // 'Car starting...'
console.log(myCar.drive());  // 'Toyota Camry is driving'
console.log(myCar.stop());   // 'Car stopped.'

// ***
describe('Prototype Chain - Step 1: Verify prototype chain', () => {
  it('should have car as prototype of myCar', () => {
    expect(Object.getPrototypeOf(myCar)).to.equal(car);
  });
  
  it('should have vehicle as prototype of car', () => {
    expect(Object.getPrototypeOf(car)).to.equal(vehicle);
  });
  
  it('should have make as own property', () => {
    expect(myCar.hasOwnProperty('make')).to.be.true;
  });
  
  it('should inherit drive method', () => {
    expect(myCar.hasOwnProperty('drive')).to.be.false;
  });
});
// ---
// Step 2: Add motorcycle branch to the prototype tree
const vehicle = {
  wheels: 0,
  start() {
    return `${this.type || 'Vehicle'} starting...`;
  },
  stop() {
    return `${this.type || 'Vehicle'} stopped.`;
  },
  getInfo() {
    return `${this.type}: ${this.wheels} wheels`;
  }
};

const car = Object.create(vehicle);
car.type = 'Car';
car.wheels = 4;
car.drive = function() {
  return `${this.make} ${this.model} is driving`;
};

const motorcycle = Object.create(vehicle);
motorcycle.type = 'Motorcycle';
motorcycle.wheels = 2;
motorcycle.wheelie = function() {
  return `${this.make} ${this.model} is doing a wheelie!`;
};

const myCar = Object.create(car);
myCar.make = 'Toyota';
myCar.model = 'Camry';

const myBike = Object.create(motorcycle);
myBike.make = 'Harley';
myBike.model = 'Davidson';

console.log(myCar.getInfo());   // 'Car: 4 wheels'
console.log(myBike.getInfo());  // 'Motorcycle: 2 wheels'
console.log(myBike.wheelie());  // 'Harley Davidson is doing a wheelie!'

// ***
describe('Prototype Chain - Step 2: Multiple inheritance branches', () => {
  it('should have correct wheel count for car', () => {
    expect(myCar.wheels).to.equal(4);
  });
  
  it('should have correct wheel count for motorcycle', () => {
    expect(myBike.wheels).to.equal(2);
  });
  
  it('should not have wheelie method on car', () => {
    expect(myCar.wheelie).to.be.undefined;
  });
  
  it('should not have drive method on motorcycle', () => {
    expect(myBike.drive).to.be.undefined;
  });
});
// ---
// Step 3: Constructor functions and prototype
function Vehicle(type, wheels) {
  this.type = type;
  this.wheels = wheels;
  this.speed = 0;
}

Vehicle.prototype.start = function() {
  this.speed = 10;
  return `${this.type} starting... Speed: ${this.speed}mph`;
};

Vehicle.prototype.accelerate = function(amount) {
  this.speed += amount;
  return `${this.type} speed: ${this.speed}mph`;
};

Vehicle.prototype.brake = function() {
  this.speed = Math.max(0, this.speed - 10);
  return `${this.type} braking... Speed: ${this.speed}mph`;
};

function Car(make, model) {
  Vehicle.call(this, 'Car', 4); // Call parent constructor
  this.make = make;
  this.model = model;
}

// Set up prototype chain
Car.prototype = Object.create(Vehicle.prototype);
Car.prototype.constructor = Car;

// Add car-specific methods
Car.prototype.drive = function() {
  return `${this.make} ${this.model} is driving at ${this.speed}mph`;
};

const myCar = new Car('Tesla', 'Model 3');
console.log(myCar.start());        // 'Car starting... Speed: 10mph'
console.log(myCar.accelerate(50)); // 'Car speed: 60mph'
console.log(myCar.drive());        // 'Tesla Model 3 is driving at 60mph'

// ***
describe('Prototype Chain - Step 3: Constructor pattern', () => {
  it('should be instance of Car', () => {
    expect(myCar).to.be.instanceof(Car);
  });
  
  it('should be instance of Vehicle', () => {
    expect(myCar).to.be.instanceof(Vehicle);
  });
  
  it('should have Car as constructor', () => {
    expect(myCar.constructor).to.equal(Car);
  });
  
  it('should have correct speed after acceleration', () => {
    expect(myCar.speed).to.equal(60);
  });
  
  it('should share methods via prototype', () => {
    const car2 = new Car('BMW', 'M3');
    expect(car2.start).to.equal(myCar.start);
  });
});
```
</SlideLayout.Center>

<SlideLayout.Center>
## ES6 Classes vs Prototypes

```javascript
// ES6 Class (syntactic sugar over prototypes)
class Animal {
  constructor(name) {
    this.name = name;
  }
  
  speak() {
    return `${this.name} makes a sound`;
  }
}

class Dog extends Animal {
  constructor(name, breed) {
    super(name);
    this.breed = breed;
  }
  
  speak() {
    return `${this.name} barks`;
  }
}

// Under the hood, it's still prototypes!
const dog = new Dog('Buddy', 'Golden Retriever');
console.log(dog.speak()); // 'Buddy barks'
console.log(dog instanceof Animal); // true
```
</SlideLayout.Center>