import { SlideLayout, Image, FlexBox, UnorderedList, ListItem, Box} from 'spectacle'

<SlideLayout.VerticalImage
  title="Type Guards"
  src="https://media.giphy.com/media/v1.Y2lkPTc5MGI3NjExbXVwYWFiM2ZneWo0Y3B3MmVmeGZ1aDZ2c3FuMWVrczNsb2I0YnJhbyZlcD12MV9pbnRlcm5hbF9naWZfYnlfaWQmY3Q9Zw/3ohzdQ1IynzclJldUQ/giphy.gif"
  listItems={[
    'Type guards help narrow down union types',
    'Common guards: typeof, instanceof, in',
    'Custom type guards with "is" keyword',
    'Essential for working with unions safely',
  ]}
/>

<SlideLayout.Full>
## Type Guards in Action

```typescript
type Result = 
  | { success: true; data: string }
  | { success: false; error: string };

function handleResult(result: Result) {
  if (result.success) {
    // TypeScript knows result.data exists here
    console.log("Success:", result.data);
  } else {
    // TypeScript knows result.error exists here
    console.log("Error:", result.error);
  }
}
```
</SlideLayout.Full>

<SlideLayout.Center>
## Exercise: Create Type Guards

```typescript
// Create type guards for different shapes
interface Circle {
  kind: "circle";
  radius: number;
}

interface Rectangle {
  kind: "rectangle";
  width: number;
  height: number;
}

interface Triangle {
  kind: "triangle";
  base: number;
  height: number;
}

type Shape = Circle | Rectangle | Triangle;

// TODO: Implement this function using type guards
function calculateArea(shape: Shape): number {
  // Your code here
  return 0;
}

// Test cases
const circle: Circle = { kind: "circle", radius: 5 };
const rectangle: Rectangle = { kind: "rectangle", width: 10, height: 20 };
const triangle: Triangle = { kind: "triangle", base: 10, height: 15 };

console.log(calculateArea(circle)); // Should be ~78.54
console.log(calculateArea(rectangle)); // Should be 200
console.log(calculateArea(triangle)); // Should be 75

//***
describe('Shape Area Calculator - Initial Implementation', () => {
  it('should calculate circle area correctly', () => {
    const testCircle: Circle = { kind: "circle", radius: 10 };
    const circleArea = calculateArea(testCircle);
    expect(circleArea).to.be.closeTo(Math.PI * 100, 0.1);
  });
  
  it('should calculate rectangle area correctly', () => {
    const testRect: Rectangle = { kind: "rectangle", width: 5, height: 10 };
    expect(calculateArea(testRect)).to.equal(50);
  });
});
// ---
// Step 1: Use discriminated union
function calculateArea(shape: Shape): number {
  switch (shape.kind) {
    case "circle":
      return Math.PI * shape.radius * shape.radius;
    case "rectangle":
      return shape.width * shape.height;
    case "triangle":
      return 0.5 * shape.base * shape.height;
    default:
      // This ensures we handle all cases
      const _exhaustive: never = shape;
      throw new Error(`Unknown shape`);
  }
}

// Test the function
const circle: Circle = { kind: "circle", radius: 5 };
const rectangle: Rectangle = { kind: "rectangle", width: 10, height: 20 };
const triangle: Triangle = { kind: "triangle", base: 10, height: 15 };

console.log(calculateArea(circle)); // ~78.54
console.log(calculateArea(rectangle)); // 200
console.log(calculateArea(triangle)); // 75

//***
describe('Shape Area Calculator - Step 1: All shapes', () => {
  const shapes: Shape[] = [
    { kind: "circle", radius: 1 },
    { kind: "rectangle", width: 4, height: 5 },
    { kind: "triangle", base: 6, height: 8 }
  ];
  
  it('should calculate circle area (radius=1) correctly', () => {
    const areas = shapes.map(calculateArea);
    expect(areas[0]).to.be.closeTo(Math.PI, 0.01);
  });
  
  it('should calculate rectangle area correctly', () => {
    const areas = shapes.map(calculateArea);
    expect(areas[1]).to.equal(20);
  });
  
  it('should calculate triangle area correctly', () => {
    const areas = shapes.map(calculateArea);
    expect(areas[2]).to.equal(24);
  });
});
// ---
// Step 2: Create custom type guard functions
function isCircle(shape: Shape): shape is Circle {
  return shape.kind === "circle";
}

function isRectangle(shape: Shape): shape is Rectangle {
  return shape.kind === "rectangle";
}

function isTriangle(shape: Shape): shape is Triangle {
  return shape.kind === "triangle";
}

// Alternative implementation using type guards
function calculateAreaWithGuards(shape: Shape): number {
  if (isCircle(shape)) {
    // TypeScript knows it's a Circle here
    return Math.PI * shape.radius * shape.radius;
  } else if (isRectangle(shape)) {
    // TypeScript knows it's a Rectangle here
    return shape.width * shape.height;
  } else if (isTriangle(shape)) {
    // TypeScript knows it's a Triangle here
    return 0.5 * shape.base * shape.height;
  }
  throw new Error("Unknown shape");
}

// Generic shape guard
function isShape<T extends Shape>(
  shape: Shape,
  kind: T['kind']
): shape is T {
  return shape.kind === kind;
}

// Usage
if (isShape<Circle>(shape, "circle")) {
  console.log("Radius:", shape.radius);
}

//***
describe('Shape Area Calculator - Step 2: Type guards', () => {
  const testShape: Shape = { kind: "circle", radius: 3 };
  
  it('should correctly identify circle with isCircle', () => {
    expect(isCircle(testShape)).to.be.true;
  });
  
  it('should not identify circle as rectangle', () => {
    expect(isRectangle(testShape)).to.be.false;
  });
  
  it('should work with generic type guard', () => {
    expect(isShape<Circle>(testShape, "circle")).to.be.true;
  });
  
  it('should produce same results with both implementations', () => {
    const area1 = calculateArea(testShape);
    const area2 = calculateAreaWithGuards(testShape);
    expect(area1).to.equal(area2);
  });
});
```
</SlideLayout.Center>

<SlideLayout.Center>
## Type Predicates

```typescript
// Custom type guard with 'is' keyword
function isString(value: unknown): value is string {
  return typeof value === 'string';
}

function isNotNull<T>(value: T | null): value is T {
  return value !== null;
}

// Using type guards
const values: (string | number | null)[] = ["hello", 42, null, "world"];

// Filter with type guard
const strings = values.filter(isString); // string[]
const nonNulls = values.filter(isNotNull); // (string | number)[]

// In conditionals
function process(value: unknown) {
  if (isString(value)) {
    console.log(value.toUpperCase()); // Safe!
  }
}
```
</SlideLayout.Center>